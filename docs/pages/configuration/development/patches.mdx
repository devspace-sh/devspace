---
title: Replacing Pods for Development
sidebar_label: replacePods
---

import FragmentImageSelector from '../../fragments/selector-image-selector.mdx';
import FragmentLabelSelector from '../../fragments/selector-label-selector.mdx';

`patches` gives you the option to apply custom yaml changes to the selected development pod. This is especially useful if you:

- Need to configure or disable an option on a pod which is not configurable via your helm chart or manifests
- Do not want to use DevSpace for your pipeline and instead only want to use DevSpace for development 
- Want to debug a setup in an already deployed app by exchanging a single pod temporarily with modifications

For example:
```yaml
vars:
  IMAGE: idonotexist:neverexisted

deployments:
  my-app:
    helm:
      values:
        containers:
        - image: ${IMAGE}

dev:
  my-dev:
    # DevSpace will try to find a pod with the given image selector. If found (even if its currently in a failed state)
    # DevSpace will copy the pod, scale down the owning ReplicaSet, Deployment or StatefulSet
    # and create the new modified pod in the cluster.
    imageSelector: ${IMAGE}
    patches:
    - op: replace
      path: spec.containers[0].command
      value: ["sleep"]
    - op: replace
      path: spec.containers[0].args
      value: ["9999999999"]
    - op: replace
      path: spec.containers[0].workingDir
      value: "/workdir"
    # This will create a terminal to the replaced pod
    terminal: {}
    # This will sync to the replaced pod's working directory
    sync:
    - path: ./
```

## How does it work?

If you define certain options under `dev.*` these will tell DevSpace to search for a pod that should be replaced with the given configuration. If DevSpace finds a pod to replace, it does the following things:
- Find out the owning Deployment or StatefulSet and copy the pod template
- Scale down the owning ReplicaSet, Deployment or StatefulSet replicas to 0
- Apply the patches and changes to the pod template
- Create a deployment with the changed pod template in the cluster

Within the `dev` part of DevSpace, replacing pods is the first step that is executed, which means that all other services such as ssh, port-forwarding, sync, log streaming or terminal forwarding will wait until DevSpace has either replaced the pods or already found replaced pods. The services will then target the newly created patched pod instead of the old one.

:::note
DevSpace will automatically recognize changes to the parent Deployment, ReplicaSet or StatefulSet and apply them to the replaced pod automatically in the next run.
:::

## Configuration

## Pod Modifications

### `patches`

`patches` define more generic patches that should be applied to the pod. You can basically modify anything in the pod here. Patch functionality follows JSON Patch([RFC](https://tools.ietf.org/html/rfc6902)) semantics, as implemented by the [yaml-patch](https://github.com/krishicks/yaml-patch) library.

The `patches` option expects a patch object which consists of the following properties:
- `op` stating the patch operation (possible values: `replace`, `add`, `remove`)
- `path` stating a jsonpath or a xpath within the pod (e.g. `metadata.annotations`, `spec.containers.name=backend.env`)
- `value` stating an arbitrary value used by the operation (e.g. a string, an integer, a boolean, a yaml object)

:::warning `op: add` only for arrays
Using `op: add` only works as expected when `path` points to an array value. Using `op: add` to add properties to an object (e.g. `metadata.annotations`) will **not** work and instead replace all existing properties.
:::

:::tip Array Paths
When you want to define a `path` that contains an array (e.g. `spec.containers`), you have two options:

1. Use the index of the array item you want to patch, e.g. `spec.containers[0]`
2. Use a property selector matching the array item(s) you want to patch, e.g. `spec.containers.name=backend`

Using a property selector is often better because it is more resilient and will not cause any issues even if the order of an array's items is changed later on. A property selector is also able to select multiple array items if all of them have the same value for this property.
:::

:::info Value For Replace / Add
If you use the `replace` or `add` operation, `value` is a mandatory property.
:::

:::info
If `value` is defined, the new value must provide the correct type to be used when adding or replacing the existing value found under `path` using the newly provided `value`, e.g. an array must be replaced with an array.
:::

#### Example: Overwrite command and args of a pod
```yaml
dev:
  my-dev:
    labelSelector:
      app.kubernetes.io/component: app-backend
    patches:
      - op: replace
        path: spec.containers[0].command
        value: ["sleep"]
      - op: replace
        path: spec.containers[0].args
        value: ["9999999999"]
```

**Explanation:**
- The `labelSelector` would select the pod created for the component deployment `app-backend`.

## Reset replaced pods

If you want to reset replaced pods and revert the cluster state to before, you can run 
```
devspace reset pods
```
