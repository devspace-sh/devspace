---
title: Configure File Synchronization
sidebar_label: sync
---

import FragmentImageSelector from '../../../_partials/selector-image-selector.mdx';
import FragmentLabelSelector from '../../../_partials/selector-label-selector.mdx';


The code synchronization feature of DevSpace allows you to use hot reloading during development as well as directly develop inside a Kubernetes container.
Especially when using programming languages and frameworks that support hot reloading with tools like nodemon, re-building and re-deploying containers is very annoying and time consuming.
Therefore, DevSpace uses a smart syncing mechanism that is able to sync local file changes to remote containers directly without the need of rebuilding or restarting the container.

When starting the development mode, DevSpace starts the file sync as configured in the `dev.*.sync` section of the `devspace.yaml`.
```yaml {11-15}
deployments:
 my-deployment:
  helm:
    values:
      containers:
      - image: john/devbackend

dev:
  my-dev:
    imageSelector: john/devbackend
    sync:
    # Map the local path ./ to the container path /app
    - path: ./:/app
      excludePaths:
      - node_modules/
```

:::info Start Sync Only
To only start the file sync without the other functions of the development mode, use a custom pipeline or `devspace sync`
:::

## Configuration

## Sync Path Mapping

### `path`
The `path` option expects a string with a path that maps a local path to a remote path.

For example:
```yaml
path: ./             # Map local working directory to remote working directory
path: my-folder:/app # Map local my-folder to remote /app
path: my-folder      # Map local my-folder to remote working-directory/my-folder
```

#### Default Value For `path`
```yaml
path: ./ # Map local working directory to remote working directory
```

## Exclude Paths
The config options for excluding paths use the same syntax as `.gitignore`.

:::note
An exclude path that matches a folder recursively excludes all files and sub-folders within this folder.
:::

### `excludePaths`
The `excludePaths` option expects an array of strings with paths that should not be synchronized between the local filesystem and the remote container filesystem.

#### Default Value For `excludePaths`
```yaml
excludePaths: [] # Do not exclude anything from file synchronization
```

#### Example: Exclude Paths from Synchronization

```yaml {11-19}
deployments:
 app-backend:
  helm:
    values:
      containers:
      - image: john/devbackend

dev:
  my-dev:
    imageSelector: john/devbackend
    sync:
    - path: ./
      excludePaths:
      - logs/
      - more/logs/
      uploadExcludePaths:
      - node_modules/
      downloadExcludePaths:
      - tmp/
```
**Explanation:**
- Files in `logs/` and in `more/logs/` would not be synchronized at all.
- Files in `node_modules/` would only be synchronized from the container to the local filesystem, but not the other way around.
- Files in `tmp/` would only be synchronized from the local to the container filesystem, but not the other way around.

#### Example: Only Sync Specific Folders

```yaml {11-16}
deployments:
  app-backend:
    helm:
      values:
        containers:
        - image: john/devbackend

dev:
  my-dev:
    imageSelector: john/devbackend
    sync:
    - path: ./
      excludePaths:
      - '**'
      - '!/my-folder-1/'
      - '!/my-folder-2/'
```
**Explanation:**
- All files will be excluded except those in folders `./my-folder-1/` and `./my-folder-2/`

### `excludeFile`
The `excludeFile` option expects a path to a file from which the exclude paths can be loaded. Once loaded, the behavior is identical to the `excludePaths` option. This is useful for sharing a common list of exclude paths between many components. The earlier example, [Exclude Paths from Synchronization](#example-exclude-paths-from-synchronization), can be converted to files as follows:

#### Example: Exclude Paths from Synchronization using files

```yaml {11-15}
deployments:
 app-backend:
  helm:
    values:
      containers:
      - image: john/devbackend

dev:
  my-dev:
    imageSelector: john/devbackend
    sync:
    - path: ./
      excludeFile: .gitignore
      uploadExcludeFile: upload.gitignore
      downloadExcludeFile: download.gitignore
```

#### Example: `.gitignore`
```
log/
more/logs/
```

#### Example: `upload.gitignore`
```
node_modules/
```

#### Example: `download.gitignore`
```
tmp/
```

### `downloadExcludePaths`
The `downloadExcludePaths` option expects an array of strings with paths that should not be synchronized from the remote container filesystem to the local filesystem.

#### Default Value For `downloadExcludePaths`
```yaml
downloadExcludePaths: [] # Do not exclude anything from file synchronization
```

#### Example
**See "[Example: Exclude Paths from Synchronization](#example-exclude-paths-from-synchronization)"**

### `downloadExcludeFile`
The `downloadExcludeFile` option expects a path to a file from which the exclude paths can be loaded. These paths should not be synchronized from the remote container filesystem to the local filesystem.

#### Default Value For `downloadExcludeFile`
```yaml
downloadExcludeFile: "" # Do not load exclude paths from a file
```

#### Example
**See "[Example: Exclude Paths from Synchronization using files](#example-exclude-paths-from-synchronization-using-files)"**

### `uploadExcludePaths`
The `uploadExcludePaths` option expects an array of strings with paths that should not be synchronized from the local filesystem to the remote container filesystem.

:::info
This option is often useful if you want to download a dependency folder (e.g. `node_modules/`) for code completion but you never want to upload anything from there because of compiled binaries that are not portable between local filesystem and container filesystem (e.g. when your local system is Windows but your containers run Linux).
:::

#### Default Value For `uploadExcludePaths`
```yaml
uploadExcludePaths: [] # Do not exclude anything from file synchronization
```

#### Example
**See "[Example: Exclude Paths from Synchronization](#example-exclude-paths-from-synchronization)"**

### `uploadExcludeFile`
The `uploadExcludeFile` option expects a path to a file from which the exclude paths can be loaded. These paths should not be synchronized from the local filesystem to the remote container filesystem.

#### Default Value For `uploadExcludeFile`
```yaml
uploadExcludeFile: "" # Do not load exclude paths from a file
```

#### Example
**See "[Example: Exclude Paths from Synchronization using files](#example-exclude-paths-from-synchronization-using-files)"**

<br/>

## Post-Sync Commands
Sometimes it is useful to execute commands after the sync uploads files/directories between the local filesystem and the container.

:::warning
Make sure that post-sync commands will **<u>not</u>** trigger a new sync process. This could lead to an **endless loop**.
:::

### `startContainer`

The `startContainer` option can be used to delay starting a container until sync has finished uploading all files initially. This is very useful if your container entrypoint requires certain files. This option requires `command` to be set; otherwise, DevSpace will not know which command to start.

#### Example: Enable Container start
```yaml
deployments:
  app-backend:
    helm:
      values:
        containers:
        - image: john/devbackend

dev:
  my-dev:
    imageSelector: john/devbackend
    # required as DevSpace otherwise doesn't know
    # what to start.
    command: ["entrypoint", "to", "container"]
    sync:
    - path: ./
      startContainer: true # Will start the container after sync is done
```

:::note Multiple `startContainer`
If multiple sync paths with `startContainer` exist, DevSpace will wait for all to finish before starting the container. You can combine `startContainer` sync configurations and non `startContainer` configurations to customize when the container is actually started.
:::

### `onUpload.restartContainer`
The `restartContainer` option expects a boolean which defines if DevSpace should restart the container every time either a single file or even a batch of files have been uploaded to the container using file sync.

:::caution Restart Helper Required
Setting `restartContainer: true` requires you to also set `command: ["my", "container", "entrypoint"]`. Otherwise, DevSpace will not know which command to restart.
:::

:::note When not to use this option
Using `restartContainer: true` is most useful if your application runs based on a compiled language and you are **not** using a framework or language specific tool which provides hot reloading capabilities. If you are using tools like nodemon or frameworks like React, Rails or Flask, they allow you to enable hot reloading which may be much faster than restarting the entire container. In this case you should disable `restartContainer`.
:::

#### Example: Enable Container Restart

```yaml {17}
deployments:
  app-backend:
    helm:
      values:
        containers:
        - image: john/devbackend

dev:
  my-dev:
    imageSelector: john/devbackend
    # required as DevSpace otherwise doesn't know
    # what to restart.
    command: ["entrypoint", "to", "container"]
    sync:
    - path: ./
      onUpload:
        restartContainer: true
```

### `onUpload.exec`
The `onUpload.exec` option defines command(s) that should be executed after DevSpace uploaded files and folder to the container. DevSpace will make sure that those commands are not executed while initially syncing the state, and command execution will also halt any syncing activities.

If this is defined together with `onUpload.restartContainer`, DevSpace will make sure that the commands are always executed **before** the container is restarted.

#### Example: Post-Upload Commands
```yaml {14-29}
deployments:
  app-backend:
    helm:
      values:
        containers:
        - image: john/devbackend

dev:
  my-dev:
    imageSelector: john/devbackend
    sync:
    - path: ./
      onUpload:
        # These post-sync commands will be executed after DevSpace synced changes to the container in the given order
        exec:
        - command: |-
            npm install
          onChange: ["./package.json"]
        - command: |-
            echo 123 > local.txt
          local: true                   # Execute this command locally instead of in the container
        - command: "touch abc.txt"      # string   | Command that should be executed after DevSpace made changes
          args: []                      # string[] | Optional args that will force DevSpace to not execute the command in a shell
          failOnError: false            # bool     | If true, DevSpace will restart the sync if the command fails (default: false)
	      local: false                  # bool     | If true, DevSpace will run the command locally instead of in the container (default: false)
	      onChange: ["package.json"]    # string[] | Optional array of file patterns that will trigger this command
	      name: my-command              # string   | DevSpace will print this name instead of the command when executing
```

## One-Directional Sync
These flags allow for local or remote container file systems to be ignored during synchronization.

### `disableDownload`
The `disableDownload` option expects a boolean which enables/disables all synchronization from the remote container filesystem to the local filesystem.

#### Default Value For `disableDownload`
```yaml
disableDownload: false # Do not ignore remote container files during synchronization
```

#### Example: Synchronize Local Filesystem Only

```yaml
deployments:
  app-backend:
    helm:
      values:
        containers:
        - image: john/devbackend

dev:
  my-dev:
    imageSelector: john/devbackend
    sync:
    - path: ./
      disableDownload: true
```

### `disableUpload`
The `disableUpload` option expects a boolean which enables/disables all synchronization from the local filesystem to the remote container filesystem.

#### Default Value For `disableUpload`
```yaml
disableUpload: false # Do not ignore local files during synchronization
```

#### Example: Synchronize Remote Container Filesystem Only

```yaml
deployments:
  app-backend:
    helm:
      values:
        containers:
        - image: john/devbackend

dev:
  my-dev:
    imageSelector: john/devbackend
    sync:
    - path: ./
      disableUpload: true
```

<br/>

## Initial Sync

### `noWatch`

If the `noWatch` option is specified, DevSpace will stop syncing after initially comparing and resolving differences. This is useful if you want a one-time sync but then continue doing other steps in your pipeline.

### `initialSync`
The `initialSync` option expects a string with an initial sync strategy. The following strategies are available:

#### • `mirrorLocal` mirrors the local filesystem inside the container (default)

1. deletes all files inside the conainer that are not existing on the local filesystem
2. uploads all files which are existing on the local filesystem but are missing within the container
3. resolves all file conflicts (different content on local filesystem than in inside the container) by preferring the file on the local filesystem (i.e. all files in the container will be replaced if they are different than on the local filesystem)

#### • `preferLocal` is like `mirrorLocal` but skips step 1.

#### • `mirrorRemote` mirrors the container files to the local filesystem:

1. deletes all files on the local filesystem that are not existing inside the container
2. downloads all files which are existing inside the container but are missing on the local filesystem
3. resolves all file conflicts (different content on local filesystem than inside the container) by preferring the file within the container (i.e. all files on the local filesystem will be replaced if they are different than inside the container)

#### • `preferRemote` is like `mirrorRemote` but skips step 1.

#### • `preferNewest` merges local and remote filesystem while resolving all conflicts

1. uploads all files which are existing on the local filesystem but are missing within the container
2. downloads all files which are existing inside the container but are missing on the local filesystem
3. resolves all file conflicts (different content on local filesystem than inside the container) by preferring the newest file (i.e. compares last modified timestamps and replaces all outdated files)

#### • `keepAll` merges local and remote filesystem without resolving any conflicts

1. uploads all files which are existing on the local filesystem but are missing within the container
2. downloads all files which are existing inside the container but are missing on the local filesystem

#### Default Value For `initialSync`
```yaml
initialSync: mirrorLocal
```

#### Example: Configuring Initial Sync

```yaml
deployments:
  app-backend:
    helm:
      values:
        containers:
        - image: john/devbackend

dev:
  my-dev:
    imageSelector: john/devbackend
    sync:
    - path: ./
      excludePaths:
      - node_modules/*
    - path: ./node_modules/:/app/node_modules/
      initialSync: preferRemote
```
**Explanation:**
With this configuration, `devspace dev` would do the following:
- DevSpace would start port-forwarding and file synchronzation.
- Initial sync is started automatically.
- The first sync config section would synchronize all files except files within `node_modules/`. This means that during initial sync, all remote files that are not existing locally would be deleted and other files would be updated to the most recent version.
- The second sync config section would only synchronize files within `node_modules/` and because of `initialSync: preferRemote`, DevSpace would download all remote files which are not present on the local filesystem and override all local files which are different than the files within the container.

### `waitInitialSync`
The `waitInitialSync` option expects a boolean which defines if DevSpace should wait until the initial sync process has terminated before opening the container terminal or the multi-container log streaming.

#### Default Value For `waitInitialSync`
```yaml
waitInitialSync: true
```

#### Example: Wait For Initial Sync To Complete
```yaml
deployments:
  app-backend:
    helm:
      values:
        containers:
        - image: john/devbackend

dev:
  my-dev:
    imageSelector: john/devbackend
    logs: {}
    sync:
    - path: ./
      waitInitialSync: false
```
**Explanation:**
With the configuration `devspace dev` would do the following:
- DevSpace would start port-forwarding and file synchronzation.
- Initial sync would be started automatically.

- Before the initial sync process is finished, DevSpace starts the log streaming.


<br/>

## Network Bandwidth Limits
Sometimes it is useful to throttle the file synchronization, especially when large files or a large number of files are expected to change during development. The following config options provide these capabilities:

### `bandwidthLimits.download`
The `bandwidthLimits.download` option expects an integer representing the max file download speed in KB/s, e.g. `download: 100` would limit the file sync to a download speed of `100 KB/s`.

:::note
By default, the file synchronization algorithm uses the maximum bandwidth possible to make the sync process as fast as possible.
:::

#### Example: Limiting Network Bandwidth

```yaml
deployments:
  app-backend:
    helm:
      values:
        containers:
        - image: john/devbackend

dev:
  my-dev:
    imageSelector: john/devbackend
    sync:
    - path: ./
      bandwidthLimits:
        download: 200 # 200 KB/s
        upload: 100   # 100 KB/s
```
**Explanation:**
- Downloading files from the container to the local filesystem is limited to a transfer speed of `200 KB/s`.
- Upload files from the local filesystem to the container is limited to a transfer speed of `100 KB/s`.

### `bandwidthLimits.upload`
The `bandwidthLimits.upload` option expects an integer representing the max file upload speed in KB/s, e.g. `upload: 100` would limit the file sync to a upload speed of `100 KB/s`.

:::note
By default, the file synchronization algorithm uses the maximum bandwidth possible to make the sync process as fast as possible.
:::

#### Example
**See "[Example: Limiting Network Bandwidth](#example-limiting-network-bandwidth)"**

## Advanced Options

### `polling`

Polling specifies if the DevSpace helper should traverse over all watched files and folders periodically in the container to identify file changes. By default, DevSpace uses [inotify](https://man7.org/linux/man-pages/man7/inotify.7.html) to detect changes. This can be more efficient, however, sometimes it might be unsupported or not feasible in certain situations, in which case, polling might be preferred.

```yaml
deployments:
  app-backend:
    helm:
      values:
        containers:
        - image: john/devbackend

dev:
  my-dev:
    imageSelector: john/devbackend
    sync:
    - path: ./
      polling: true
```

:::info
Polling might increase CPU consumption of the container drastically, depending on the amount of files and folders watched
:::

:::info
If you are using a DevSpace config version below `v1beta10`, polling will be enabled by default, as it was the default syncing method in older DevSpace versions
:::

## Useful Commands

### `devspace sync`
If you want to start file synchronzation on-demand without having to configure it in `devspace.yaml` and without starting port-forwarding or log streaming etc, you can use the `devspace sync` command as shown in the examples below:
```bash
# Select pod with a picker
devspace sync --local-path=subfolder --container-path=/app

# Select pod and container by name and use current working directory as local-path
devspace sync --pod=my-pod --container=my-container --container-path=/app
```



## FAQ

<details>
<summary>How does the sync work?</summary>

<br/>

DevSpace establishes a bi-directional code synchronization between the specified local folders and the remote container folders. It automatically recognizes any changes within the specified folders during the session and will update the corresponding files locally and remotely in the background. It uses a small helper binary that is injected into the target container to accomplish this.

The algorithm roughly works like this:

1. Inject a small helper binary via `kubectl cp` into the target container
2. Run initial sync accoring to the [`initialSync` config option](#initial-sync)
3. Watch for file changes on both sides (local and remote) and sync them according to the [sync path mappings](#sync-path-mapping)
4. After every sync process, [restart the container](#onuploadrestartcontainer) or run other custom [post-sync commands](#post-sync-commands) (optional)

<br/>

</details>

<details>
<summary>Are there any requirements for the sync to work?</summary>

<br/>

The `tar` command has to be present in the container otherwise `kubectl cp` does not work and the helper binary cannot be injected into the container.

Other than that, no server-side component or special container privileges for code synchronization are required, as the sync algorithm runs completely client-only within DevSpace. The synchronization mechanism works with any container filesystem and no special binaries have to be installed into the containers. File watchers running within the containers like nodemon will also recognize changes made by the synchronization mechanism.

<br/>

</details>

<details>
<summary>What is the performance impact on using the file sync?</summary>

<br/>

The sync mechanism is normally very reliable and fast. Syncing several thousand files is usually not a problem. Changes are packed together and compressed during synchronization, which improves performance especially for transferring text files. Transferring large compressed binary files is possible, but can affect performance negatively. Remote changes can sometimes have a delay of 1-2 seconds till they are downloaded, depending on how big the synchronized folder is. It should be generally avoided to sync the complete container filesystem.

<br/>

</details>
